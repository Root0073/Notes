# TCP的拥塞控制方法
## 慢开始和拥塞避免
拥塞控制也叫基于窗口的拥塞控制，发送方维持一个叫做拥塞窗口cwnd的状态变量，拥塞庄口的大小取决于网络的拥塞成都，并且是动态变化的，发送方让自己的发送窗口等于拥塞窗口

慢开始； 当主机并不清楚当前网络的负荷状况时，如果立即把大量数据字节注入到网络，有可能会引起拥塞，所以由小到大逐渐增大注入到网络中的数据字节，所以就是由小到大逐渐增大拥塞窗口数值

每次对新的报文段的确认后，就把拥塞窗口增加最多一个SMSS的数值

我们用报文段的个数作为窗口大小的单位

为了防止cwnd增长过大而引起网络拥塞，还需要设置一个慢开始门限ssthresh
当cwnd《ssthresh时，使用慢开始算法
当cwnd > ssthresh时，停止使用慢开始算法而改用拥塞避免算法
如果相等则两个都可以

拥塞避免算法的目的是让拥塞窗口cwnd缓慢的增大，在这个阶段内cwnd按现行规律缓慢增长

使用快重传算法可以让发送方尽早知道发送了个别报文段的丢失，快重传算法首先要求接收方不要等待自己发送数据时才进行捎带确认，而是立即发送确认，即使收到了失序的报文段也要立即发出对已收到报文的重复确认

如果发送方知道只是丢失了个别报文段就启动快恢复算法，使得ssthresh = cwnd / 2 
同时设置cwnd = ssthresh

发送方的发送窗口一定不能超过对方给出的接收方窗口值rwnd

# 主动队列管理AQM
路由器的队列通常按照先进先出的规则来处理到来的分组

当队列已满，以后再到达的所有分组都将被丢弃，这就叫做尾部丢弃策略

我为了避免发生网络中的全局同步现象，提出了主动队列管理AQM

在队列长度到达某个值时就主动丢弃到达的分组

早期使用随机早期检测RED，当检测到网络拥塞的早期征兆时就以概率p丢弃个别的分组

# TCP的运输管理连接
运输连接有三个阶段：连接建立，数据传送和连接释放

B的TCP服务器进程先创建传输控制块TCB，A也首先创立TCB，A先向B发出连接请求报文段，这时首部中的同步位SYN=1，同时选择一个初始序号seg=x，B在收到请求报文段后如果容易建立连接则发送确认，确认号是ack=x+1，seq=y，这个报文段也不能携带数据，同样要消耗一个序号

A在收到b的确认后还要向bg给出确认，确认好ack=y+1，seq=x+1，然后通过三报文握手已建立连接 

## TCP的连接释放
A先把连接释放的报文段首部的终止控制位FIN置1，其序号seq=u，B收到后发出确认，确认号ack=u+1，seq=v, ACK=1 

这时的TCP连接处于半关闭状态,B还需要向A发送FIN=1，ACK=1，seq=w，ack=u+1

随后A在向B发送ACK=1，seq=u+1，ack=w+1 

这时候TCP连接还没有释放掉，必须经过时间等待计时器设置的时间2MSL之后才进入到关闭状态，MSL是最长报文段寿命

TCP还有一个保活计时器

