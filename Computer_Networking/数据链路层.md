# 数据链路层的几个共同问题
数据链路层使用的信道主要有以下两种类似：
1. 点对点信道
2. 广播信道

本章重要的内容是
1. 数据链路层点对点信道和广播信道的特点，以及这两种信道所使用的协议，PPP协议和CSMA/CD协议
2. 数据链路层三个基本问题：封装成帧，透明传输和差错检测
3. 以太网MAC层的硬件地址
4. 适配器，转发器，集线器，网桥和以太网交换机的作用和使用场合

## 数据链路和帧
链路：一个节点到相邻节点的一段物理线路，而中间没有任何其他的交换节点

数据链路：把协议的硬件和软件加到链路上，就构成了数据链路，最常用的是网络适配器

最早的数据通信协议曾叫做通信规程

数据链路层把网络层交下来的数据构成帧发送到链路上，以及吧接收到的帧的数据取出并上交给网络层

点对点信道的数据里娜鲁曾的协议数据单元就是帧，而网络层是ip数据报

## 三个基本问题
### 封装成帧
封装成帧就是在一段数据的前后分别添加首部和尾部，这样就构成了一个帧，接收端在收到物理层上交的比特流之后就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束


## 三个基本问题
### 封装成帧
首部和尾部的一个重要的作用就是进行帧定界(确定帧的界限)

每一种链路层协议都规定了所能传送的帧的数据部分长度上限，最大传送单元MTU

当数据是由可打印的ASCII码组成的文本文件，帧界定符可以使用特定的帧界定符

SOH放在一帧的最前面，表示帧的首部开始，另一个控制字符EOT表示帧的结束

### 透明传输
当传送的帧是用文本文件组成的帧时，其数据部分不会出现像SOH和EOT这样的帧界定字符，可见不管从键盘上输入什么字符都可以放在这样的帧中传输过去，这样传输就是透明传输

透明传输意味着无论怎么样的比特组合数据都能够按照原样没有差错的通过这个数据链路层

为了解决这个问题，就必须设法是数据中出现的SOH和EOT在接收端不被解释为控制字符，方法是在SOH和EOT前面加一个转义字符ESC，而在接收段的数据链路层吧数据送往网络层之前删除这个插入的转义字符

这个就叫字节填充或字符填充

如果转义字符也出现在当中，那么解决方式是在转义字符的前面插入一个转义字符

### 差错检测
在一段时间内，传输错误的比特占所有传输比特总数的比率叫做误码率BER，在数据链路层广泛使用了循环冗余检验CRC的检错技术

可以被认为：凡是接收端数据链路层接收端帧均误差错

收到的帧并没有比特差错，但是却出现了帧丢失，帧重复和帧失序，这三此种情况属于出现传输差错

## 点对点协议 PPP
### PPP协议的特点
简单 封装成帧 透明性 多种网络层协议 多种类型链路 差错检测 检测连接状态 最大传送单元 网络层地址协商 数据压缩协商
### PPP协议的组成
1. 一个将IP数据报封装到串行链路的方法,PPP既支持异步链路也持支面向比特的同步链路，IP数据报在PPP帧中就是琦信息部分
2. 一个用来建立 配置和测试数据链路连接的链路控制协议LCP
3. 一套网络控制协议NCP

### PPP协议的协议帧格式
PPP协议采用零比特填充的方法来实现透明传输，方法是只要发现有连续五个1就在后面补0

### PPP协议的工作状态
PPP链路的起始和终止状态永远是链路静止，这时在个人用户电脑和ISP的路由器之间不存在物理层的连接

在双方建立了物理层连接后，PPP就进入链路建立状态，目的是建立链路层的LCP连接，这是LCP开始协商一些配置选项，即发送LCP的配置请求帧，有以下几种响应的一种：
1. 配置确认帧：所有选项都接受
2. 配置否认帧：所有选项都理解但不接受
3. 配置拒绝帧：选项有点无法识别或不能接受，需要协商

协商结束后双方建立LCP链路，接着进入鉴别状态，只允许传送LCP协议的分鉴别协议的分组以及检测链路质量的分组，若鉴别成功则进出网络层协议状态，否则进入链路终止

在网络层协议状态中，PPP链路两端的网络控制协议NCP根据网络层的不同协议互相交换网络层特定的网络控制分组

如果运行的是IP协议，则对PPP链路的每一段配置IP协议模块时就要使用NCP中的ip控制协议IPCP，IPCP分组也要封装成ppp帧

当网络层配置结束后，链路就可进入链路打开状态，彼此向对方发送分组，两个端点还能发送回送请求LCP分组和会送回答LCP分组检查状态

传输结束后u，发送终止请求LCP分组，在收到对方的终止确认LCP分组后转到链路终止状态，当调制调节器的载波停止后，则回到链路静止状态

## 使用广播信道的数据链路层
局域网的特点：网络为一个单位所拥有，且地理范围和站点数目均有限

### 适配器的作用
计算机与外部局域网的连接是通过适配器完成的，也就是网卡

计算机要发送IP数据报时，就有协议栈把ip数据报向下交给适配器，组装成帧后交给发送到局域网

计算机的硬件地址在适配器的ROM中，软件地址(ip地址)在计算机的存储器中

### CSMA/CD协议
这个协议就是用来解决以太网在同一时间只能允许一台计算机发送数据的问题

以太网发送的数据都使用曼彻斯特编码的信号

CSMA/DA协议的要点：
1. 多点接入说明这是总线型网络，许多计算机以多点接入的法师连接在同一根总线上，协议的实质是载波监听和碰撞检测

2. 载波监听就是边发送边监听，不管在发送数据之前还是之中，每个站都必须不停地检测信道，如果有别的站在发送就不发送，如果在发送中发现别的站也在发送就立即中断本站的发送，这就叫碰撞检测

在使用CSMA/DA协议时，一个站不可能同时发送和接受，因此只能进行双向交替信道

以太网发送的不确定性：每一个站在主机发送数据之后的一小段时间内，存在着遭遇碰撞的可能性，这一小段时间是不确定的

一个站再发送数据帧之多2r（r为电磁波在1km电缆的传播时延，约5微秒），这一哦段时间被称为争用期，又称为碰撞窗口，经过争用期这段时间还没有检测到碰撞才能肯定这次发送不会发生碰撞

以太网使用截断二进制指数退避算法来确定碰撞后重传的时机，这种算法让发生碰撞的站在停止发送数据后，不是等待信道变为空闲后立即发送数据而是退避一个随机的时间

基本退避时间为争用期2r，具体点争用期事件是512比特时间

凡是长度小于64字节的帧都是由于冲突而异常终止的无效帧

强化碰撞：当发送数据的站发现发生了碰撞时，除立即停止之外还要在发送32比特或者48比特的人为干扰信号

CSMA/CD要点如下：
1. 准备发送：适配器从网络层获得一个分组，加上以太网的首部和尾部，组成以太网帧，再发送之前必须检测信道
2. 一直检测直到信道转为空闲，若在96比特时间内信道保持空闲，就发送这个帧
3. 再发送过程俄中仍不停地检测信道，即网络适配器要边发送边监听
若在争用期内检测到碰撞，这是立即停止发送数据，并按规定发送认为干扰信号，适配器接着执行指数退避算法，等待r倍512比特时间后返回步骤2，若重传16次仍不能成功则停止并向上报错

### 集线器
使用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线，使用的还是CSMA/CD协议，同一时刻至多只允许一个站发送数据

一个集线器有许多端口，很像是一个多端口的转发器

集线器工作在物理层，每个端口仅仅简单的转发比特，不进行碰撞检测

### 以太网的信道利用率
成功发送一个帧需要占用信道的时间是T0+r，因为最后一个比特还需要在以太网上传播

在以太网中定义了参数a，他是以太网单程端到端时r和帧的发送时间之比

a越小证明争用期所占的比例越小，所以当数据率一定时，以太网连线的长度会受到限制，同时以太网的帧长不能太短

极限信道利用率为T0/T0 + r = 1 / （1 + a）

# 高速以太网
## 100BASE-T
仍使用CSMA/CD协议，他又称为快速以太网

想从细缆升级到快速以太网的用户需要重新布线

## 吉比特以太网 
是用来载波延伸的方法，争用期增大到512字节

新增了一种功能被称为分组突发

## 10吉比特以太网和更快的以太网
只工作在全双工方式，不存在争用问题，不使用CSMA/CD协议 

## 使用以太网进行宽带接入
也常使用高速以太网进行接入


